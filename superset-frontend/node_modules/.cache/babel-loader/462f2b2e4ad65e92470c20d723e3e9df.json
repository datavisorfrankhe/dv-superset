{"ast":null,"code":"var _jsxFileName = \"/Users/frankhe/projects/superset/superset-frontend/src/SqlLab/components/ShareSqlLabQuery.tsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t, useTheme, styled } from '@superset-ui/core';\nimport Button from 'src/components/Button';\nimport withToasts from 'src/messageToasts/enhancers/withToasts';\nimport Icons from 'src/components/Icons';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { storeQuery } from 'src/utils/common';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { FeatureFlag, isFeatureEnabled } from '../../featureFlags';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst StyledIcon = styled(Icons.Link)`\n  &:first-of-type {\n    margin: 0;\n    display: flex;\n    svg {\n      margin: 0;\n    }\n  }\n`;\nfunction ShareSqlLabQuery({ queryEditor, addDangerToast }) {\n  const theme = useTheme();\n  const getCopyUrlForKvStore = (callback) => {\n    const { dbId, title, schema, autorun, sql } = queryEditor;\n    const sharedQuery = { dbId, title, schema, autorun, sql };\n    return storeQuery(sharedQuery).\n    then((shortUrl) => {\n      callback(shortUrl);\n    }).\n    catch((response) => {\n      getClientErrorObject(response).then(() => {\n        addDangerToast(t('There was an error with your request'));\n      });\n    });\n  };\n  const getCopyUrlForSavedQuery = (callback) => {\n    let savedQueryToastContent;\n    if (queryEditor.remoteId) {\n      savedQueryToastContent = `${window.location.origin + window.location.pathname}?savedQueryId=${queryEditor.remoteId}`;\n      callback(savedQueryToastContent);\n    } else\n    {\n      savedQueryToastContent = t('Please save the query to enable sharing');\n      callback(savedQueryToastContent);\n    }\n  };\n  const getCopyUrl = (callback) => {\n    if (isFeatureEnabled(FeatureFlag.SHARE_QUERIES_VIA_KV_STORE)) {\n      return getCopyUrlForKvStore(callback);\n    }\n    return getCopyUrlForSavedQuery(callback);\n  };\n  const buildButton = (canShare) => {\n    const tooltip = canShare ?\n    t('Copy query link to your clipboard') :\n    t('Save the query to enable this feature');\n    return ___EmotionJSX(Button, { buttonSize: \"small\", tooltip: tooltip, disabled: !canShare, __self: this, __source: { fileName: _jsxFileName, lineNumber: 73, columnNumber: 17 } },\n    ___EmotionJSX(StyledIcon, { iconColor: canShare ? theme.colors.primary.base : theme.colors.grayscale.base, iconSize: \"xl\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 74, columnNumber: 9 } }),\n    t('Copy link'));\n\n  };\n  const canShare = !!queryEditor.remoteId ||\n  isFeatureEnabled(FeatureFlag.SHARE_QUERIES_VIA_KV_STORE);\n  return ___EmotionJSX(React.Fragment, null,\n  canShare ? ___EmotionJSX(CopyToClipboard, { getText: getCopyUrl, wrapped: false, copyNode: buildButton(canShare), __self: this, __source: { fileName: _jsxFileName, lineNumber: 81, columnNumber: 20 } }) : buildButton(canShare));\n\n}__signature__(ShareSqlLabQuery, \"useTheme{theme}\", () => [useTheme]);const _default =\nwithToasts(ShareSqlLabQuery);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(StyledIcon, \"StyledIcon\", \"/Users/frankhe/projects/superset/superset-frontend/src/SqlLab/components/ShareSqlLabQuery.tsx\");reactHotLoader.register(ShareSqlLabQuery, \"ShareSqlLabQuery\", \"/Users/frankhe/projects/superset/superset-frontend/src/SqlLab/components/ShareSqlLabQuery.tsx\");reactHotLoader.register(_default, \"default\", \"/Users/frankhe/projects/superset/superset-frontend/src/SqlLab/components/ShareSqlLabQuery.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/Users/frankhe/projects/superset/superset-frontend/src/SqlLab/components/ShareSqlLabQuery.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t, useTheme, styled } from '@superset-ui/core';\n\nimport Button from 'src/components/Button';\nimport withToasts from 'src/messageToasts/enhancers/withToasts';\nimport Icons from 'src/components/Icons';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { storeQuery } from 'src/utils/common';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { FeatureFlag, isFeatureEnabled } from '../../featureFlags';\n\ninterface ShareSqlLabQueryPropTypes {\n  queryEditor: {\n    dbId: number;\n    title: string;\n    schema: string;\n    autorun: boolean;\n    sql: string;\n    remoteId: number | null;\n  };\n  addDangerToast: (msg: string) => void;\n}\n\nconst StyledIcon = styled(Icons.Link)`\n  &:first-of-type {\n    margin: 0;\n    display: flex;\n    svg {\n      margin: 0;\n    }\n  }\n`;\n\nfunction ShareSqlLabQuery({\n  queryEditor,\n  addDangerToast,\n}: ShareSqlLabQueryPropTypes) {\n  const theme = useTheme();\n\n  const getCopyUrlForKvStore = (callback: Function) => {\n    const { dbId, title, schema, autorun, sql } = queryEditor;\n    const sharedQuery = { dbId, title, schema, autorun, sql };\n\n    return storeQuery(sharedQuery)\n      .then(shortUrl => {\n        callback(shortUrl);\n      })\n      .catch(response => {\n        getClientErrorObject(response).then(() => {\n          addDangerToast(t('There was an error with your request'));\n        });\n      });\n  };\n\n  const getCopyUrlForSavedQuery = (callback: Function) => {\n    let savedQueryToastContent;\n\n    if (queryEditor.remoteId) {\n      savedQueryToastContent = `${\n        window.location.origin + window.location.pathname\n      }?savedQueryId=${queryEditor.remoteId}`;\n      callback(savedQueryToastContent);\n    } else {\n      savedQueryToastContent = t('Please save the query to enable sharing');\n      callback(savedQueryToastContent);\n    }\n  };\n  const getCopyUrl = (callback: Function) => {\n    if (isFeatureEnabled(FeatureFlag.SHARE_QUERIES_VIA_KV_STORE)) {\n      return getCopyUrlForKvStore(callback);\n    }\n    return getCopyUrlForSavedQuery(callback);\n  };\n\n  const buildButton = (canShare: boolean) => {\n    const tooltip = canShare\n      ? t('Copy query link to your clipboard')\n      : t('Save the query to enable this feature');\n    return (\n      <Button buttonSize=\"small\" tooltip={tooltip} disabled={!canShare}>\n        <StyledIcon\n          iconColor={\n            canShare ? theme.colors.primary.base : theme.colors.grayscale.base\n          }\n          iconSize=\"xl\"\n        />\n        {t('Copy link')}\n      </Button>\n    );\n  };\n\n  const canShare =\n    !!queryEditor.remoteId ||\n    isFeatureEnabled(FeatureFlag.SHARE_QUERIES_VIA_KV_STORE);\n\n  return (\n    <>\n      {canShare ? (\n        <CopyToClipboard\n          getText={getCopyUrl}\n          wrapped={false}\n          copyNode={buildButton(canShare)}\n        />\n      ) : (\n        buildButton(canShare)\n      )}\n    </>\n  );\n}\n\nexport default withToasts(ShareSqlLabQuery);\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}