{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _reject from \"lodash/reject\";var _jsxFileName = \"/Users/frankhe/projects/superset/superset-frontend/src/views/CRUD/welcome/Welcome.tsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { styled, t } from '@superset-ui/core';\nimport Collapse from 'src/components/Collapse';\n\nimport { getFromLocalStorage, setInLocalStorage } from 'src/utils/localStorageHelpers';\nimport withToasts from 'src/messageToasts/enhancers/withToasts';\nimport Loading from 'src/components/Loading';\nimport { createErrorHandler, getRecentAcitivtyObjs, mq, getUserOwnedObjects } from 'src/views/CRUD/utils';\nimport { HOMEPAGE_ACTIVITY_FILTER } from 'src/views/CRUD/storageKeys';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport { Switch } from 'src/common/components';\nimport ActivityTable from './ActivityTable';\nimport ChartTable from './ChartTable';\nimport SavedQueries from './SavedQueries';\nimport DashboardTable from './DashboardTable';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst DEFAULT_TAB_ARR = ['2', '3'];\nconst WelcomeContainer = styled.div`\n  background-color: ${({ theme }) => theme.colors.grayscale.light4};\n  .ant-row.menu {\n    margin-top: -15px;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    &:after {\n      content: '';\n      display: block;\n      border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n      margin: 0px ${({ theme }) => theme.gridUnit * 6}px;\n      position: relative;\n      width: 100%;\n      ${mq[1]} {\n        margin-top: 5px;\n        margin: 0px 2px;\n      }\n    }\n    .ant-menu.ant-menu-light.ant-menu-root.ant-menu-horizontal {\n      padding-left: ${({ theme }) => theme.gridUnit * 8}px;\n    }\n    button {\n      padding: 3px 21px;\n    }\n  }\n  .ant-card.ant-card-bordered {\n    border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n  .ant-collapse-item .ant-collapse-content {\n    margin-bottom: ${({ theme }) => theme.gridUnit * -6}px;\n  }\n  div.ant-collapse-item:last-child.ant-collapse-item-active\n    .ant-collapse-header {\n    padding-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n  }\n  div.ant-collapse-item:last-child .ant-collapse-header {\n    padding-bottom: ${({ theme }) => theme.gridUnit * 9}px;\n  }\n`;\nconst WelcomeNav = styled.div`\n  height: 50px;\n  background-color: white;\n  .navbar-brand {\n    margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n    font-weight: ${({ theme }) => theme.typography.weights.bold};\n  }\n  .switch {\n    float: right;\n    margin: ${({ theme }) => theme.gridUnit * 5}px;\n    display: flex;\n    flex-direction: row;\n    span {\n      display: block;\n      margin: ${({ theme }) => theme.gridUnit * 1}px;\n      line-height: 1;\n    }\n  }\n`;\nfunction Welcome({ user, addDangerToast }) {\n  const userid = user.userId;\n  const id = userid.toString();\n  const recent = `/superset/recent_activity/${user.userId}/?limit=6`;\n  const [activeChild, setActiveChild] = useState('Loading');\n  const userKey = getFromLocalStorage(id, null);\n  let defaultChecked = false;\n  if (isFeatureEnabled(FeatureFlag.THUMBNAILS)) {\n    defaultChecked =\n    (userKey == null ? void 0 : userKey.thumbnails) === undefined ? true : userKey == null ? void 0 : userKey.thumbnails;\n  }\n  const [checked, setChecked] = useState(defaultChecked);\n  const [activityData, setActivityData] = useState(null);\n  const [chartData, setChartData] = useState(null);\n  const [queryData, setQueryData] = useState(null);\n  const [dashboardData, setDashboardData] = useState(null);\n  const [loadedCount, setLoadedCount] = useState(0);\n  const [activeState, setActiveState] = useState(DEFAULT_TAB_ARR);\n  const handleCollapse = (state) => {\n    setActiveState(state);\n  };\n  useEffect(() => {\n    const activeTab = getFromLocalStorage(HOMEPAGE_ACTIVITY_FILTER, null);\n    getRecentAcitivtyObjs(user.userId, recent, addDangerToast).\n    then((res) => {\n      const data = {};\n      data.Examples = res.examples;\n      if (res.viewed) {var _context;\n        const filtered = _mapInstanceProperty(_context = _reject(res.viewed, ['item_url', null])).call(_context, (r) => r);\n        data.Viewed = filtered;\n        if (!activeTab && data.Viewed) {\n          setActiveChild('Viewed');\n        } else\n        if (!activeTab && !data.Viewed) {\n          setActiveChild('Created');\n        } else\n\n        setActiveChild(activeTab);\n      } else\n      if (!activeTab)\n      setActiveChild('Created');else\n\n      setActiveChild(activeTab);\n      setActivityData((activityData) => ({ ...activityData, ...data }));\n    }).\n    catch(createErrorHandler((errMsg) => {\n      setActivityData((activityData) => ({ ...activityData, Viewed: [] }));\n      addDangerToast(t('There was an issue fetching your recent activity: %s', errMsg));\n    }));\n    // Sets other activity data in parallel with recents api call\n    getUserOwnedObjects(id, 'dashboard').\n    then((r) => {\n      setDashboardData(r);\n      setLoadedCount((loadedCount) => loadedCount + 1);\n    }).\n    catch((err) => {\n      setDashboardData([]);\n      setLoadedCount((loadedCount) => loadedCount + 1);\n      addDangerToast(t('There was an issues fetching your dashboards: %s', err));\n    });\n    getUserOwnedObjects(id, 'chart').\n    then((r) => {\n      setChartData(r);\n      setLoadedCount((loadedCount) => loadedCount + 1);\n    }).\n    catch((err) => {\n      setChartData([]);\n      setLoadedCount((loadedCount) => loadedCount + 1);\n      addDangerToast(t('There was an issues fetching your chart: %s', err));\n    });\n    getUserOwnedObjects(id, 'saved_query').\n    then((r) => {\n      setQueryData(r);\n      setLoadedCount((loadedCount) => loadedCount + 1);\n    }).\n    catch((err) => {\n      setQueryData([]);\n      setLoadedCount((loadedCount) => loadedCount + 1);\n      addDangerToast(t('There was an issues fetching your saved queries: %s', err));\n    });\n  }, []);\n  const handleToggle = () => {\n    setChecked(!checked);\n    setInLocalStorage(id, { thumbnails: !checked });\n  };\n  useEffect(() => {\n    if (queryData != null && queryData.length) {\n      setActiveState((activeState) => [...activeState, '4']);\n    }\n    setActivityData((activityData) => ({\n      ...activityData,\n      Created: [\n      ...((chartData == null ? void 0 : _sliceInstanceProperty(chartData).call(chartData, 0, 3)) || []),\n      ...((dashboardData == null ? void 0 : _sliceInstanceProperty(dashboardData).call(dashboardData, 0, 3)) || []),\n      ...((queryData == null ? void 0 : _sliceInstanceProperty(queryData).call(queryData, 0, 3)) || [])] }));\n\n\n  }, [chartData, queryData, dashboardData]);\n  useEffect(() => {var _activityData$Viewed;\n    if (activityData != null && (_activityData$Viewed = activityData.Viewed) != null && _activityData$Viewed.length) {\n      setActiveState((activeState) => ['1', ...activeState]);\n    }\n  }, [activityData]);\n  const isRecentActivityLoading = !(activityData != null && activityData.Examples) && !(activityData != null && activityData.Viewed);\n  return ___EmotionJSX(WelcomeContainer, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 196, columnNumber: 13 } },\n  ___EmotionJSX(WelcomeNav, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 197, columnNumber: 7 } },\n  ___EmotionJSX(\"span\", { className: \"navbar-brand\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 198, columnNumber: 9 } }, \"Home\"),\n  isFeatureEnabled(FeatureFlag.THUMBNAILS) ? ___EmotionJSX(\"div\", { className: \"switch\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 199, columnNumber: 54 } },\n  ___EmotionJSX(Switch, { checked: checked, onChange: handleToggle, __self: this, __source: { fileName: _jsxFileName, lineNumber: 200, columnNumber: 13 } }),\n  ___EmotionJSX(\"span\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 201, columnNumber: 13 } }, \"Thumbnails\")) :\n  null),\n\n  ___EmotionJSX(Collapse, { activeKey: activeState, onChange: handleCollapse, ghost: true, bigger: true, __self: this, __source: { fileName: _jsxFileName, lineNumber: 204, columnNumber: 7 } },\n  ___EmotionJSX(Collapse.Panel, { header: t('Recents'), key: \"1\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 205, columnNumber: 9 } },\n  activityData && (\n  activityData.Viewed ||\n  activityData.Examples ||\n  activityData.Created) &&\n  activeChild !== 'Loading' ? ___EmotionJSX(ActivityTable, { user: user, activeChild: activeChild, setActiveChild: setActiveChild, activityData: activityData, loadedCount: loadedCount, __self: this, __source: { fileName: _jsxFileName, lineNumber: 210, columnNumber: 42 } }) : ___EmotionJSX(Loading, { position: \"inline\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 210, columnNumber: 187 } })),\n\n  ___EmotionJSX(Collapse.Panel, { header: t('Dashboards'), key: \"2\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 212, columnNumber: 9 } },\n  !dashboardData || isRecentActivityLoading ? ___EmotionJSX(Loading, { position: \"inline\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 213, columnNumber: 57 } }) : ___EmotionJSX(DashboardTable, { user: user, mine: dashboardData, showThumbnails: checked, examples: activityData == null ? void 0 : activityData.Examples, __self: this, __source: { fileName: _jsxFileName, lineNumber: 213, columnNumber: 90 } })),\n\n  ___EmotionJSX(Collapse.Panel, { header: t('Charts'), key: \"3\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 215, columnNumber: 9 } },\n  !chartData || isRecentActivityLoading ? ___EmotionJSX(Loading, { position: \"inline\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 216, columnNumber: 53 } }) : ___EmotionJSX(ChartTable, { showThumbnails: checked, user: user, mine: chartData, examples: activityData == null ? void 0 : activityData.Examples, __self: this, __source: { fileName: _jsxFileName, lineNumber: 216, columnNumber: 86 } })),\n\n  ___EmotionJSX(Collapse.Panel, { header: t('Saved queries'), key: \"4\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 218, columnNumber: 9 } },\n  !queryData ? ___EmotionJSX(Loading, { position: \"inline\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 219, columnNumber: 26 } }) : ___EmotionJSX(SavedQueries, { showThumbnails: checked, user: user, mine: queryData, featureFlag: isFeatureEnabled(FeatureFlag.THUMBNAILS), __self: this, __source: { fileName: _jsxFileName, lineNumber: 219, columnNumber: 59 } }))));\n\n\n\n}__signature__(Welcome, \"useState{[activeChild, setActiveChild]('Loading')}\\nuseState{[checked, setChecked](defaultChecked)}\\nuseState{[activityData, setActivityData](null)}\\nuseState{[chartData, setChartData](null)}\\nuseState{[queryData, setQueryData](null)}\\nuseState{[dashboardData, setDashboardData](null)}\\nuseState{[loadedCount, setLoadedCount](0)}\\nuseState{[activeState, setActiveState](DEFAULT_TAB_ARR)}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\");const _default =\nwithToasts(Welcome);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(DEFAULT_TAB_ARR, \"DEFAULT_TAB_ARR\", \"/Users/frankhe/projects/superset/superset-frontend/src/views/CRUD/welcome/Welcome.tsx\");reactHotLoader.register(WelcomeContainer, \"WelcomeContainer\", \"/Users/frankhe/projects/superset/superset-frontend/src/views/CRUD/welcome/Welcome.tsx\");reactHotLoader.register(WelcomeNav, \"WelcomeNav\", \"/Users/frankhe/projects/superset/superset-frontend/src/views/CRUD/welcome/Welcome.tsx\");reactHotLoader.register(Welcome, \"Welcome\", \"/Users/frankhe/projects/superset/superset-frontend/src/views/CRUD/welcome/Welcome.tsx\");reactHotLoader.register(_default, \"default\", \"/Users/frankhe/projects/superset/superset-frontend/src/views/CRUD/welcome/Welcome.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/Users/frankhe/projects/superset/superset-frontend/src/views/CRUD/welcome/Welcome.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { styled, t } from '@superset-ui/core';\nimport Collapse from 'src/components/Collapse';\nimport { User } from 'src/types/bootstrapTypes';\nimport { reject } from 'lodash';\nimport {\n  getFromLocalStorage,\n  setInLocalStorage,\n} from 'src/utils/localStorageHelpers';\nimport withToasts from 'src/messageToasts/enhancers/withToasts';\nimport Loading from 'src/components/Loading';\nimport {\n  createErrorHandler,\n  getRecentAcitivtyObjs,\n  mq,\n  getUserOwnedObjects,\n} from 'src/views/CRUD/utils';\nimport { HOMEPAGE_ACTIVITY_FILTER } from 'src/views/CRUD/storageKeys';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport { Switch } from 'src/common/components';\n\nimport ActivityTable from './ActivityTable';\nimport ChartTable from './ChartTable';\nimport SavedQueries from './SavedQueries';\nimport DashboardTable from './DashboardTable';\n\ninterface WelcomeProps {\n  user: User;\n  addDangerToast: (arg0: string) => void;\n}\n\nexport interface ActivityData {\n  Created?: Array<object>;\n  Edited?: Array<object>;\n  Viewed?: Array<object>;\n  Examples?: Array<object>;\n}\n\nconst DEFAULT_TAB_ARR = ['2', '3'];\n\nconst WelcomeContainer = styled.div`\n  background-color: ${({ theme }) => theme.colors.grayscale.light4};\n  .ant-row.menu {\n    margin-top: -15px;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    &:after {\n      content: '';\n      display: block;\n      border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n      margin: 0px ${({ theme }) => theme.gridUnit * 6}px;\n      position: relative;\n      width: 100%;\n      ${mq[1]} {\n        margin-top: 5px;\n        margin: 0px 2px;\n      }\n    }\n    .ant-menu.ant-menu-light.ant-menu-root.ant-menu-horizontal {\n      padding-left: ${({ theme }) => theme.gridUnit * 8}px;\n    }\n    button {\n      padding: 3px 21px;\n    }\n  }\n  .ant-card.ant-card-bordered {\n    border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n  .ant-collapse-item .ant-collapse-content {\n    margin-bottom: ${({ theme }) => theme.gridUnit * -6}px;\n  }\n  div.ant-collapse-item:last-child.ant-collapse-item-active\n    .ant-collapse-header {\n    padding-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n  }\n  div.ant-collapse-item:last-child .ant-collapse-header {\n    padding-bottom: ${({ theme }) => theme.gridUnit * 9}px;\n  }\n`;\n\nconst WelcomeNav = styled.div`\n  height: 50px;\n  background-color: white;\n  .navbar-brand {\n    margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n    font-weight: ${({ theme }) => theme.typography.weights.bold};\n  }\n  .switch {\n    float: right;\n    margin: ${({ theme }) => theme.gridUnit * 5}px;\n    display: flex;\n    flex-direction: row;\n    span {\n      display: block;\n      margin: ${({ theme }) => theme.gridUnit * 1}px;\n      line-height: 1;\n    }\n  }\n`;\n\nfunction Welcome({ user, addDangerToast }: WelcomeProps) {\n  const userid = user.userId;\n  const id = userid.toString();\n  const recent = `/superset/recent_activity/${user.userId}/?limit=6`;\n  const [activeChild, setActiveChild] = useState('Loading');\n  const userKey = getFromLocalStorage(id, null);\n  let defaultChecked = false;\n  if (isFeatureEnabled(FeatureFlag.THUMBNAILS)) {\n    defaultChecked =\n      userKey?.thumbnails === undefined ? true : userKey?.thumbnails;\n  }\n  const [checked, setChecked] = useState(defaultChecked);\n  const [activityData, setActivityData] = useState<ActivityData | null>(null);\n  const [chartData, setChartData] = useState<Array<object> | null>(null);\n  const [queryData, setQueryData] = useState<Array<object> | null>(null);\n  const [dashboardData, setDashboardData] = useState<Array<object> | null>(\n    null,\n  );\n  const [loadedCount, setLoadedCount] = useState(0);\n  const [activeState, setActiveState] = useState<Array<string>>(\n    DEFAULT_TAB_ARR,\n  );\n\n  const handleCollapse = (state: Array<string>) => {\n    setActiveState(state);\n  };\n\n  useEffect(() => {\n    const activeTab = getFromLocalStorage(HOMEPAGE_ACTIVITY_FILTER, null);\n    getRecentAcitivtyObjs(user.userId, recent, addDangerToast)\n      .then(res => {\n        const data: ActivityData | null = {};\n        data.Examples = res.examples;\n        if (res.viewed) {\n          const filtered = reject(res.viewed, ['item_url', null]).map(r => r);\n          data.Viewed = filtered;\n          if (!activeTab && data.Viewed) {\n            setActiveChild('Viewed');\n          } else if (!activeTab && !data.Viewed) {\n            setActiveChild('Created');\n          } else setActiveChild(activeTab);\n        } else if (!activeTab) setActiveChild('Created');\n        else setActiveChild(activeTab);\n        setActivityData(activityData => ({ ...activityData, ...data }));\n      })\n      .catch(\n        createErrorHandler((errMsg: unknown) => {\n          setActivityData(activityData => ({ ...activityData, Viewed: [] }));\n          addDangerToast(\n            t('There was an issue fetching your recent activity: %s', errMsg),\n          );\n        }),\n      );\n\n    // Sets other activity data in parallel with recents api call\n\n    getUserOwnedObjects(id, 'dashboard')\n      .then(r => {\n        setDashboardData(r);\n        setLoadedCount(loadedCount => loadedCount + 1);\n      })\n      .catch((err: unknown) => {\n        setDashboardData([]);\n        setLoadedCount(loadedCount => loadedCount + 1);\n        addDangerToast(\n          t('There was an issues fetching your dashboards: %s', err),\n        );\n      });\n    getUserOwnedObjects(id, 'chart')\n      .then(r => {\n        setChartData(r);\n        setLoadedCount(loadedCount => loadedCount + 1);\n      })\n      .catch((err: unknown) => {\n        setChartData([]);\n        setLoadedCount(loadedCount => loadedCount + 1);\n        addDangerToast(t('There was an issues fetching your chart: %s', err));\n      });\n    getUserOwnedObjects(id, 'saved_query')\n      .then(r => {\n        setQueryData(r);\n        setLoadedCount(loadedCount => loadedCount + 1);\n      })\n      .catch((err: unknown) => {\n        setQueryData([]);\n        setLoadedCount(loadedCount => loadedCount + 1);\n        addDangerToast(\n          t('There was an issues fetching your saved queries: %s', err),\n        );\n      });\n  }, []);\n\n  const handleToggle = () => {\n    setChecked(!checked);\n    setInLocalStorage(id, { thumbnails: !checked });\n  };\n\n  useEffect(() => {\n    if (queryData?.length) {\n      setActiveState(activeState => [...activeState, '4']);\n    }\n    setActivityData(activityData => ({\n      ...activityData,\n      Created: [\n        ...(chartData?.slice(0, 3) || []),\n        ...(dashboardData?.slice(0, 3) || []),\n        ...(queryData?.slice(0, 3) || []),\n      ],\n    }));\n  }, [chartData, queryData, dashboardData]);\n\n  useEffect(() => {\n    if (activityData?.Viewed?.length) {\n      setActiveState(activeState => ['1', ...activeState]);\n    }\n  }, [activityData]);\n\n  const isRecentActivityLoading =\n    !activityData?.Examples && !activityData?.Viewed;\n  return (\n    <WelcomeContainer>\n      <WelcomeNav>\n        <span className=\"navbar-brand\">Home</span>\n        {isFeatureEnabled(FeatureFlag.THUMBNAILS) ? (\n          <div className=\"switch\">\n            <Switch checked={checked} onChange={handleToggle} />\n            <span>Thumbnails</span>\n          </div>\n        ) : null}\n      </WelcomeNav>\n      <Collapse activeKey={activeState} onChange={handleCollapse} ghost bigger>\n        <Collapse.Panel header={t('Recents')} key=\"1\">\n          {activityData &&\n          (activityData.Viewed ||\n            activityData.Examples ||\n            activityData.Created) &&\n          activeChild !== 'Loading' ? (\n            <ActivityTable\n              user={user}\n              activeChild={activeChild}\n              setActiveChild={setActiveChild}\n              activityData={activityData}\n              loadedCount={loadedCount}\n            />\n          ) : (\n            <Loading position=\"inline\" />\n          )}\n        </Collapse.Panel>\n        <Collapse.Panel header={t('Dashboards')} key=\"2\">\n          {!dashboardData || isRecentActivityLoading ? (\n            <Loading position=\"inline\" />\n          ) : (\n            <DashboardTable\n              user={user}\n              mine={dashboardData}\n              showThumbnails={checked}\n              examples={activityData?.Examples}\n            />\n          )}\n        </Collapse.Panel>\n        <Collapse.Panel header={t('Charts')} key=\"3\">\n          {!chartData || isRecentActivityLoading ? (\n            <Loading position=\"inline\" />\n          ) : (\n            <ChartTable\n              showThumbnails={checked}\n              user={user}\n              mine={chartData}\n              examples={activityData?.Examples}\n            />\n          )}\n        </Collapse.Panel>\n        <Collapse.Panel header={t('Saved queries')} key=\"4\">\n          {!queryData ? (\n            <Loading position=\"inline\" />\n          ) : (\n            <SavedQueries\n              showThumbnails={checked}\n              user={user}\n              mine={queryData}\n              featureFlag={isFeatureEnabled(FeatureFlag.THUMBNAILS)}\n            />\n          )}\n        </Collapse.Panel>\n      </Collapse>\n    </WelcomeContainer>\n  );\n}\n\nexport default withToasts(Welcome);\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}