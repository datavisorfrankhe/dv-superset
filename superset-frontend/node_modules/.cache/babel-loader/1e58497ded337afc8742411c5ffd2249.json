{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";var _jsxFileName = \"/Users/frankhe/projects/superset/superset-frontend/src/views/CRUD/welcome/SavedQueries.tsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState } from 'react';\nimport { t, SupersetClient, styled, useTheme } from '@superset-ui/core';\nimport SyntaxHighlighter from 'react-syntax-highlighter/dist/cjs/light';\nimport sql from 'react-syntax-highlighter/dist/cjs/languages/hljs/sql';\nimport github from 'react-syntax-highlighter/dist/cjs/styles/hljs/github';\nimport withToasts from 'src/messageToasts/enhancers/withToasts';\nimport Loading from 'src/components/Loading';\nimport { Dropdown, Menu } from 'src/common/components';\nimport { useListViewResource, copyQueryLink } from 'src/views/CRUD/hooks';\nimport ListViewCard from 'src/components/ListViewCard';\nimport DeleteModal from 'src/components/DeleteModal';\nimport Icons from 'src/components/Icons';\nimport SubMenu from 'src/components/Menu/SubMenu';\nimport EmptyState from './EmptyState';\nimport { CardContainer, createErrorHandler, shortenSQL, PAGE_SIZE } from '../utils';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nSyntaxHighlighter.registerLanguage('sql', sql);\nexport const CardStyles = styled.div`\n  cursor: pointer;\n  a {\n    text-decoration: none;\n  }\n  .ant-card-cover {\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    & > div {\n      height: 171px;\n    }\n  }\n  .gradient-container > div {\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n    background-color: ${({ theme }) => theme.colors.secondary.light3};\n    display: inline-block;\n    width: 100%;\n    height: 179px;\n    background-repeat: no-repeat;\n    vertical-align: middle;\n  }\n`;\nconst QueryData = styled.div`\n  svg {\n    margin-left: ${({ theme }) => theme.gridUnit * 10}px;\n  }\n  .query-title {\n    padding: ${({ theme }) => theme.gridUnit * 2 + 2}px;\n    font-size: ${({ theme }) => theme.typography.sizes.l}px;\n  }\n`;\nconst QueryContainer = styled.div`\n  pre {\n    height: ${({ theme }) => theme.gridUnit * 40}px;\n    border: none !important;\n    background-color: ${({ theme }) => theme.colors.grayscale.light5} !important;\n    overflow: hidden;\n    padding: ${({ theme }) => theme.gridUnit * 4}px !important;\n  }\n`;\nconst SavedQueries = ({ user, addDangerToast, addSuccessToast, mine, showThumbnails, featureFlag }) => {\n  const { state: { loading, resourceCollection: queries }, hasPerm, fetchData, refreshData } = useListViewResource('saved_query', t('query'), addDangerToast, true, mine, [], false);\n  const [queryFilter, setQueryFilter] = useState('Mine');\n  const [queryDeleteModal, setQueryDeleteModal] = useState(false);\n  const [currentlyEdited, setCurrentlyEdited] = useState({});\n  const [ifMine, setMine] = useState(true);\n  const canEdit = hasPerm('can_edit');\n  const canDelete = hasPerm('can_delete');\n  const theme = useTheme();\n  const handleQueryDelete = ({ id, label }) => {\n    SupersetClient.delete({\n      endpoint: `/api/v1/saved_query/${id}` }).\n    then(() => {\n      const queryParams = {\n        filters: [\n        {\n          id: 'created_by',\n          operator: 'rel_o_m',\n          value: `${user == null ? void 0 : user.userId}` }],\n\n\n        pageSize: PAGE_SIZE,\n        sortBy: [\n        {\n          id: 'changed_on_delta_humanized',\n          desc: true }],\n\n\n        pageIndex: 0 };\n\n      // if mine is default there refresh data with current filters\n      const filter = ifMine ? queryParams : undefined;\n      refreshData(filter);\n      setMine(false);\n      setQueryDeleteModal(false);\n      addSuccessToast(t('Deleted: %s', label));\n    }, createErrorHandler((errMsg) => addDangerToast(t('There was an issue deleting %s: %s', label, errMsg))));\n  };\n  const getFilters = (filterName) => {\n    const filters = [];\n    if (filterName === 'Mine') {\n      filters.push({\n        id: 'created_by',\n        operator: 'rel_o_m',\n        value: `${user == null ? void 0 : user.userId}` });\n\n    } else\n    {\n      filters.push({\n        id: 'id',\n        operator: 'saved_query_is_fav',\n        value: true });\n\n    }\n    return filters;\n  };\n  const getData = (filter) => fetchData({\n    pageIndex: 0,\n    pageSize: PAGE_SIZE,\n    sortBy: [\n    {\n      id: 'changed_on_delta_humanized',\n      desc: true }],\n\n\n    filters: getFilters(filter) });\n\n  const renderMenu = (query) => ___EmotionJSX(Menu, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 143, columnNumber: 36 } },\n  canEdit && ___EmotionJSX(Menu.Item, { onClick: () => {\n      window.location.href = `/superset/sqllab?savedQueryId=${query.id}`;\n    }, __self: this, __source: { fileName: _jsxFileName, lineNumber: 144, columnNumber: 20 } },\n  t('Edit')),\n\n  ___EmotionJSX(Menu.Item, { onClick: () => {\n      if (query.id) {\n        copyQueryLink(query.id, addDangerToast, addSuccessToast);\n      }\n    }, __self: this, __source: { fileName: _jsxFileName, lineNumber: 149, columnNumber: 7 } },\n  t('Share')),\n\n  canDelete && ___EmotionJSX(Menu.Item, { onClick: () => {\n      setQueryDeleteModal(true);\n      setCurrentlyEdited(query);\n    }, __self: this, __source: { fileName: _jsxFileName, lineNumber: 156, columnNumber: 22 } },\n  t('Delete')));\n\n\n  if (loading)\n  return ___EmotionJSX(Loading, { position: \"inline\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 164, columnNumber: 16 } });\n  return ___EmotionJSX(React.Fragment, null,\n  queryDeleteModal && ___EmotionJSX(DeleteModal, { description: t('This action will permanently delete the saved query.'), onConfirm: () => {\n      if (queryDeleteModal) {\n        handleQueryDelete(currentlyEdited);\n      }\n    }, onHide: () => {\n      setQueryDeleteModal(false);\n    }, open: true, title: t('Delete Query?'), __self: this, __source: { fileName: _jsxFileName, lineNumber: 166, columnNumber: 29 } }),\n  ___EmotionJSX(SubMenu, { activeChild: queryFilter, tabs: [\n    /* @TODO uncomment when fav functionality is implemented\n    {\n      name: 'Favorite',\n      label: t('Favorite'),\n      onClick: () => {\n        getData('Favorite').then(() => setQueryFilter('Favorite'));\n      },\n    },\n    */\n    {\n      name: 'Mine',\n      label: t('Mine'),\n      onClick: () => getData('Mine').then(() => setQueryFilter('Mine')) }],\n\n    buttons: [\n    {\n      name: ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(\"i\", { className: \"fa fa-plus\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 191, columnNumber: 17 } }), \"SQL Query\"),\n\n\n      buttonStyle: 'tertiary',\n      onClick: () => {\n        window.location.href = '/superset/sqllab?new=true';\n      } },\n\n    {\n      name: 'View All »',\n      buttonStyle: 'link',\n      onClick: () => {\n        window.location.href = '/savedqueryview/list';\n      } }], __self: this, __source: { fileName: _jsxFileName, lineNumber: 173, columnNumber: 7 } }),\n\n\n  queries.length > 0 ? ___EmotionJSX(CardContainer, { showThumbnails: showThumbnails, __self: this, __source: { fileName: _jsxFileName, lineNumber: 207, columnNumber: 30 } },\n  _mapInstanceProperty(queries).call(queries, (q) => {var _q$sql, _q$sql2;return ___EmotionJSX(CardStyles, { onClick: () => {\n        window.location.href = `/superset/sqllab?savedQueryId=${q.id}`;\n      }, key: q.id, __self: this, __source: { fileName: _jsxFileName, lineNumber: 208, columnNumber: 30 } },\n    ___EmotionJSX(ListViewCard, { imgURL: \"\", url: `/superset/sqllab?savedQueryId=${q.id}`, title: q.label, imgFallbackURL: \"/static/assets/images/empty-query.svg\", description: t('Ran %s', q.changed_on_delta_humanized), cover: q != null && (_q$sql = q.sql) != null && _q$sql.length && showThumbnails && featureFlag ? ___EmotionJSX(QueryContainer, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 211, columnNumber: 270 } },\n      ___EmotionJSX(SyntaxHighlighter, { language: \"sql\", lineProps: {\n          style: {\n            color: 'black',\n            wordBreak: 'break-all',\n            whiteSpace: 'pre-wrap' } },\n\n        style: github, wrapLines: true, lineNumberStyle: {\n          display: 'none' },\n        showLineNumbers: false, __self: this, __source: { fileName: _jsxFileName, lineNumber: 212, columnNumber: 23 } },\n      shortenSQL(q.sql, 25))) :\n\n      showThumbnails && !(q != null && (_q$sql2 = q.sql) != null && _q$sql2.length) ? false : ___EmotionJSX(React.Fragment, null), actions: ___EmotionJSX(QueryData, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 223, columnNumber: 106 } },\n      ___EmotionJSX(ListViewCard.Actions, { onClick: (e) => {\n          e.stopPropagation();\n          e.preventDefault();\n        }, __self: this, __source: { fileName: _jsxFileName, lineNumber: 224, columnNumber: 21 } },\n      ___EmotionJSX(Dropdown, { overlay: renderMenu(q), __self: this, __source: { fileName: _jsxFileName, lineNumber: 228, columnNumber: 23 } },\n      ___EmotionJSX(Icons.MoreHoriz, { iconColor: theme.colors.grayscale.base, __self: this, __source: { fileName: _jsxFileName, lineNumber: 229, columnNumber: 25 } })))), __self: this, __source: { fileName: _jsxFileName, lineNumber: 211, columnNumber: 15 } }));})) :\n\n\n\n\n  ___EmotionJSX(EmptyState, { tableName: \"SAVED_QUERIES\", tab: queryFilter, __self: this, __source: { fileName: _jsxFileName, lineNumber: 234, columnNumber: 30 } }));\n\n};__signature__(SavedQueries, \"useListViewResource{{ state: { loading, resourceCollection: queries }, hasPerm, fetchData, refreshData, }}\\nuseState{[queryFilter, setQueryFilter]('Mine')}\\nuseState{[queryDeleteModal, setQueryDeleteModal](false)}\\nuseState{[currentlyEdited, setCurrentlyEdited]({})}\\nuseState{[ifMine, setMine](true)}\\nuseTheme{theme}\", () => [useListViewResource, useTheme]);const _default =\nwithToasts(SavedQueries);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(CardStyles, \"CardStyles\", \"/Users/frankhe/projects/superset/superset-frontend/src/views/CRUD/welcome/SavedQueries.tsx\");reactHotLoader.register(QueryData, \"QueryData\", \"/Users/frankhe/projects/superset/superset-frontend/src/views/CRUD/welcome/SavedQueries.tsx\");reactHotLoader.register(QueryContainer, \"QueryContainer\", \"/Users/frankhe/projects/superset/superset-frontend/src/views/CRUD/welcome/SavedQueries.tsx\");reactHotLoader.register(SavedQueries, \"SavedQueries\", \"/Users/frankhe/projects/superset/superset-frontend/src/views/CRUD/welcome/SavedQueries.tsx\");reactHotLoader.register(_default, \"default\", \"/Users/frankhe/projects/superset/superset-frontend/src/views/CRUD/welcome/SavedQueries.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/Users/frankhe/projects/superset/superset-frontend/src/views/CRUD/welcome/SavedQueries.tsx"],"names":[],"mappings":"uiBAAA;;;;;;;;;;;;;;;;;AAiBG;AACH,OAAO,KAAP,IAAgB,QAAhB,QAAgC,OAAhC;AACA,SAAS,CAAT,EAAY,cAAZ,EAA4B,MAA5B,EAAoC,QAApC,QAAoD,mBAApD;AACA,OAAO,iBAAP,MAA8B,yCAA9B;AACA,OAAO,GAAP,MAAgB,sDAAhB;AACA,OAAO,MAAP,MAAmB,sDAAnB;AACA,OAAO,UAAP,MAAuB,wCAAvB;AACA,OAAO,OAAP,MAAoB,wBAApB;AACA,SAAS,QAAT,EAAmB,IAAnB,QAA+B,uBAA/B;AACA,SAAS,mBAAT,EAA8B,aAA9B,QAAmD,sBAAnD;AACA,OAAO,YAAP,MAAyB,6BAAzB;AACA,OAAO,WAAP,MAAwB,4BAAxB;AACA,OAAO,KAAP,MAAkB,sBAAlB;AACA,OAAO,OAAP,MAAoB,6BAApB;AACA,OAAO,UAAP,MAAuB,cAAvB;AACA,SACE,aADF,EAEE,kBAFF,EAGE,UAHF,EAIE,SAJF,QAKO,UALP,C;AAOA,iBAAiB,CAAC,gBAAlB,CAAmC,KAAnC,EAA0C,GAA1C;AA4BA,OAAO,MAAM,UAAU,GAAG,MAAM,CAAC,GAAG;;;;;;+BAML,CAAC,EAAE,KAAF,EAAD,KAAe,KAAK,CAAC,MAAN,CAAa,SAAb,CAAuB,MAAM;;;;;;;;;wBASnD,CAAC,EAAE,KAAF,EAAD,KAAe,KAAK,CAAC,MAAN,CAAa,SAAb,CAAuB,MAAM;;;;;;;AAOnE,CAtBM;AAwBP,MAAM,SAAS,GAAG,MAAM,CAAC,GAAG;;mBAET,CAAC,EAAE,KAAF,EAAD,KAAe,KAAK,CAAC,QAAN,GAAiB,EAAE;;;eAGtC,CAAC,EAAE,KAAF,EAAD,KAAe,KAAK,CAAC,QAAN,GAAiB,CAAjB,GAAqB,CAAC;iBACnC,CAAC,EAAE,KAAF,EAAD,KAAe,KAAK,CAAC,UAAN,CAAiB,KAAjB,CAAuB,CAAC;;AAEvD,CARD;AAUA,MAAM,cAAc,GAAG,MAAM,CAAC,GAAG;;cAEnB,CAAC,EAAE,KAAF,EAAD,KAAe,KAAK,CAAC,QAAN,GAAiB,EAAE;;wBAExB,CAAC,EAAE,KAAF,EAAD,KAClB,KAAK,CAAC,MAAN,CAAa,SAAb,CAAuB,MAAM;;eAEpB,CAAC,EAAE,KAAF,EAAD,KAAe,KAAK,CAAC,QAAN,GAAiB,CAAC;;AAE/C,CATD;AAWA,MAAM,YAAY,GAAG,CAAC,EACpB,IADoB,EAEpB,cAFoB,EAGpB,eAHoB,EAIpB,IAJoB,EAKpB,cALoB,EAMpB,WANoB,EAAD,KAOG;AACtB,QAAM,EACJ,KAAK,EAAE,EAAE,OAAF,EAAW,kBAAkB,EAAE,OAA/B,EADH,EAEJ,OAFI,EAGJ,SAHI,EAIJ,WAJI,KAKF,mBAAmB,CACrB,aADqB,EAErB,CAAC,CAAC,OAAD,CAFoB,EAGrB,cAHqB,EAIrB,IAJqB,EAKrB,IALqB,EAMrB,EANqB,EAOrB,KAPqB,CALvB;AAcA,QAAM,CAAC,WAAD,EAAc,cAAd,IAAgC,QAAQ,CAAC,MAAD,CAA9C;AACA,QAAM,CAAC,gBAAD,EAAmB,mBAAnB,IAA0C,QAAQ,CAAC,KAAD,CAAxD;AACA,QAAM,CAAC,eAAD,EAAkB,kBAAlB,IAAwC,QAAQ,CAAQ,EAAR,CAAtD;AACA,QAAM,CAAC,MAAD,EAAS,OAAT,IAAoB,QAAQ,CAAC,IAAD,CAAlC;AACA,QAAM,OAAO,GAAG,OAAO,CAAC,UAAD,CAAvB;AACA,QAAM,SAAS,GAAG,OAAO,CAAC,YAAD,CAAzB;AAEA,QAAM,KAAK,GAAG,QAAQ,EAAtB;AAEA,QAAM,iBAAiB,GAAG,CAAC,EAAE,EAAF,EAAM,KAAN,EAAD,KAAyB;AACjD,IAAA,cAAc,CAAC,MAAf,CAAsB;AACpB,MAAA,QAAQ,EAAE,uBAAuB,EAAE,EADf,EAAtB;AAEG,IAAA,IAFH,CAGE,MAAK;AACH,YAAM,WAAW,GAAG;AAClB,QAAA,OAAO,EAAE;AACP;AACE,UAAA,EAAE,EAAE,YADN;AAEE,UAAA,QAAQ,EAAE,SAFZ;AAGE,UAAA,KAAK,EAAE,GAAG,IAAH,oBAAG,IAAI,CAAE,MAAM,EAHxB,EADO,CADS;;;AAQlB,QAAA,QAAQ,EAAE,SARQ;AASlB,QAAA,MAAM,EAAE;AACN;AACE,UAAA,EAAE,EAAE,4BADN;AAEE,UAAA,IAAI,EAAE,IAFR,EADM,CATU;;;AAelB,QAAA,SAAS,EAAE,CAfO,EAApB;;AAiBA;AACA,YAAM,MAAM,GAAG,MAAM,GAAG,WAAH,GAAiB,SAAtC;AACA,MAAA,WAAW,CAAC,MAAD,CAAX;AACA,MAAA,OAAO,CAAC,KAAD,CAAP;AACA,MAAA,mBAAmB,CAAC,KAAD,CAAnB;AACA,MAAA,eAAe,CAAC,CAAC,CAAC,aAAD,EAAgB,KAAhB,CAAF,CAAf;AACD,KA3BH,EA4BE,kBAAkB,CAAC,CAAA,MAAM,KACvB,cAAc,CAAC,CAAC,CAAC,oCAAD,EAAuC,KAAvC,EAA8C,MAA9C,CAAF,CADE,CA5BpB;AAgCD,GAjCD;AAmCA,QAAM,UAAU,GAAG,CAAC,UAAD,KAAuB;AACxC,UAAM,OAAO,GAAG,EAAhB;AACA,QAAI,UAAU,KAAK,MAAnB,EAA2B;AACzB,MAAA,OAAO,CAAC,IAAR,CAAa;AACX,QAAA,EAAE,EAAE,YADO;AAEX,QAAA,QAAQ,EAAE,SAFC;AAGX,QAAA,KAAK,EAAE,GAAG,IAAH,oBAAG,IAAI,CAAE,MAAM,EAHX,EAAb;;AAKD,KAND;AAMO;AACL,MAAA,OAAO,CAAC,IAAR,CAAa;AACX,QAAA,EAAE,EAAE,IADO;AAEX,QAAA,QAAQ,EAAE,oBAFC;AAGX,QAAA,KAAK,EAAE,IAHI,EAAb;;AAKD;AACD,WAAO,OAAP;AACD,GAhBD;AAkBA,QAAM,OAAO,GAAG,CAAC,MAAD,KACd,SAAS,CAAC;AACR,IAAA,SAAS,EAAE,CADH;AAER,IAAA,QAAQ,EAAE,SAFF;AAGR,IAAA,MAAM,EAAE;AACN;AACE,MAAA,EAAE,EAAE,4BADN;AAEE,MAAA,IAAI,EAAE,IAFR,EADM,CAHA;;;AASR,IAAA,OAAO,EAAE,UAAU,CAAC,MAAD,CATX,EAAD,CADX;;AAaA,QAAM,UAAU,GAAG,CAAC,KAAD,KACjB,cAAC,IAAD;AACG,EAAA,OAAO,IACN,cAAC,IAAD,CAAM,IAAN,IACE,OAAO,EAAE,MAAK;AACZ,MAAA,MAAM,CAAC,QAAP,CAAgB,IAAhB,GAAuB,iCAAiC,KAAK,CAAC,EAAE,EAAhE;AACD,KAHH;AAKG,EAAA,CAAC,CAAC,MAAD,CALJ,CAFJ;;AAUE,gBAAC,IAAD,CAAM,IAAN,IACE,OAAO,EAAE,MAAK;AACZ,UAAI,KAAK,CAAC,EAAV,EAAc;AACZ,QAAA,aAAa,CAAC,KAAK,CAAC,EAAP,EAAW,cAAX,EAA2B,eAA3B,CAAb;AACD;AACF,KALH;AAOG,EAAA,CAAC,CAAC,OAAD,CAPJ,CAVF;;AAmBG,EAAA,SAAS,IACR,cAAC,IAAD,CAAM,IAAN,IACE,OAAO,EAAE,MAAK;AACZ,MAAA,mBAAmB,CAAC,IAAD,CAAnB;AACA,MAAA,kBAAkB,CAAC,KAAD,CAAlB;AACD,KAJH;AAMG,EAAA,CAAC,CAAC,QAAD,CANJ,CApBJ,CADF;;;AAiCA,MAAI,OAAJ;AAAa,SAAO,cAAC,OAAD,IAAS,QAAQ,EAAC,QAAlB,0FAAP;AACb,SACE;AACG,EAAA,gBAAgB,IACf,cAAC,WAAD,IACE,WAAW,EAAE,CAAC,CACZ,sDADY,CADhB,EAIE,SAAS,EAAE,MAAK;AACd,UAAI,gBAAJ,EAAsB;AACpB,QAAA,iBAAiB,CAAC,eAAD,CAAjB;AACD;AACF,KARH,EASE,MAAM,EAAE,MAAK;AACX,MAAA,mBAAmB,CAAC,KAAD,CAAnB;AACD,KAXH,EAYE,IAAI,MAZN,EAaE,KAAK,EAAE,CAAC,CAAC,eAAD,CAbV,0FAFJ;AAkBE,gBAAC,OAAD,IACE,WAAW,EAAE,WADf,EAEE,IAAI,EAAE;AACJ;;;;;;;;AAQE;AACF;AACE,MAAA,IAAI,EAAE,MADR;AAEE,MAAA,KAAK,EAAE,CAAC,CAAC,MAAD,CAFV;AAGE,MAAA,OAAO,EAAE,MAAM,OAAO,CAAC,MAAD,CAAP,CAAgB,IAAhB,CAAqB,MAAM,cAAc,CAAC,MAAD,CAAzC,CAHjB,EAVI,CAFR;;AAkBE,IAAA,OAAO,EAAE;AACP;AACE,MAAA,IAAI,EACF;AACE,2BAAG,SAAS,EAAC,YAAb,0FADF,cAFJ;;;AAOE,MAAA,WAAW,EAAE,UAPf;AAQE,MAAA,OAAO,EAAE,MAAK;AACZ,QAAA,MAAM,CAAC,QAAP,CAAgB,IAAhB,GAAuB,2BAAvB;AACD,OAVH,EADO;;AAaP;AACE,MAAA,IAAI,EAAE,YADR;AAEE,MAAA,WAAW,EAAE,MAFf;AAGE,MAAA,OAAO,EAAE,MAAK;AACZ,QAAA,MAAM,CAAC,QAAP,CAAgB,IAAhB,GAAuB,sBAAvB;AACD,OALH,EAbO,CAlBX,yFAlBF;;;AA0DG,EAAA,OAAO,CAAC,MAAR,GAAiB,CAAjB,GACC,cAAC,aAAD,IAAe,cAAc,EAAE,cAA/B;AACG,uBAAA,OAAO,MAAP,CAAA,OAAO,EAAK,CAAA,CAAC,iCACZ,cAAC,UAAD,IACE,OAAO,EAAE,MAAK;AACZ,QAAA,MAAM,CAAC,QAAP,CAAgB,IAAhB,GAAuB,iCAAiC,CAAC,CAAC,EAAE,EAA5D;AACD,OAHH,EAIE,GAAG,EAAE,CAAC,CAAC,EAJT;AAME,kBAAC,YAAD,IACE,MAAM,EAAC,EADT,EAEE,GAAG,EAAE,iCAAiC,CAAC,CAAC,EAAE,EAF5C,EAGE,KAAK,EAAE,CAAC,CAAC,KAHX,EAIE,cAAc,EAAC,uCAJjB,EAKE,WAAW,EAAE,CAAC,CAAC,QAAD,EAAW,CAAC,CAAC,0BAAb,CALhB,EAME,KAAK,EACH,CAAC,QAAD,cAAA,CAAC,CAAE,GAAH,oBAAQ,MAAR,IAAkB,cAAlB,IAAoC,WAApC,GACE,cAAC,cAAD;AACE,oBAAC,iBAAD,IACE,QAAQ,EAAC,KADX,EAEE,SAAS,EAAE;AACT,UAAA,KAAK,EAAE;AACL,YAAA,KAAK,EAAE,OADF;AAEL,YAAA,SAAS,EAAE,WAFN;AAGL,YAAA,UAAU,EAAE,UAHP,EADE,EAFb;;AASE,QAAA,KAAK,EAAE,MATT,EAUE,SAAS,MAVX,EAWE,eAAe,EAAE;AACf,UAAA,OAAO,EAAE,MADM,EAXnB;AAcE,QAAA,eAAe,EAAE,KAdnB;AAgBG,MAAA,UAAU,CAAC,CAAC,CAAC,GAAH,EAAQ,EAAR,CAhBb,CADF,CADF;;AAqBI,MAAA,cAAc,IAAI,EAAC,CAAD,uBAAC,CAAC,CAAE,GAAJ,aAAC,QAAQ,MAAT,CAAlB,GACF,KADE,GAGF,mCA/BN,EAkCE,OAAO,EACL,cAAC,SAAD;AACE,oBAAC,YAAD,CAAc,OAAd,IACE,OAAO,EAAE,CAAA,CAAC,KAAG;AACX,UAAA,CAAC,CAAC,eAAF;AACA,UAAA,CAAC,CAAC,cAAF;AACD,SAJH;AAME,oBAAC,QAAD,IAAU,OAAO,EAAE,UAAU,CAAC,CAAD,CAA7B;AACE,oBAAC,KAAD,CAAO,SAAP,IACE,SAAS,EAAE,KAAK,CAAC,MAAN,CAAa,SAAb,CAAuB,IADpC,0FADF,CANF,CADF,CAnCJ,0FANF,CADY,EAAN,CADV,CADD;;;;;AAgEC,gBAAC,UAAD,IAAY,SAAS,EAAC,eAAtB,EAAsC,GAAG,EAAE,WAA3C,0FA1HJ,CADF;;AA+HD,CAlQD,C,cAAM,Y,2UAaA,mB,EAgBU,Q;AAuOD,UAAU,CAAC,YAAD,C,CAAzB,wB,iLAjTa,U,sIAwBP,S,qIAUA,c,0IAWA,Y","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState } from 'react';\nimport { t, SupersetClient, styled, useTheme } from '@superset-ui/core';\nimport SyntaxHighlighter from 'react-syntax-highlighter/dist/cjs/light';\nimport sql from 'react-syntax-highlighter/dist/cjs/languages/hljs/sql';\nimport github from 'react-syntax-highlighter/dist/cjs/styles/hljs/github';\nimport withToasts from 'src/messageToasts/enhancers/withToasts';\nimport Loading from 'src/components/Loading';\nimport { Dropdown, Menu } from 'src/common/components';\nimport { useListViewResource, copyQueryLink } from 'src/views/CRUD/hooks';\nimport ListViewCard from 'src/components/ListViewCard';\nimport DeleteModal from 'src/components/DeleteModal';\nimport Icons from 'src/components/Icons';\nimport SubMenu from 'src/components/Menu/SubMenu';\nimport EmptyState from './EmptyState';\nimport {\n  CardContainer,\n  createErrorHandler,\n  shortenSQL,\n  PAGE_SIZE,\n} from '../utils';\n\nSyntaxHighlighter.registerLanguage('sql', sql);\n\ninterface Query {\n  id?: number;\n  sql_tables?: Array<any>;\n  database?: {\n    database_name: string;\n  };\n  rows?: string;\n  description?: string;\n  end_time?: string;\n  label?: string;\n  changed_on_delta_humanized?: string;\n  sql?: string | null;\n}\n\ninterface SavedQueriesProps {\n  user: {\n    userId: string | number;\n  };\n  queryFilter: string;\n  addDangerToast: (arg0: string) => void;\n  addSuccessToast: (arg0: string) => void;\n  mine: Array<Query>;\n  showThumbnails: boolean;\n  featureFlag: boolean;\n}\n\nexport const CardStyles = styled.div`\n  cursor: pointer;\n  a {\n    text-decoration: none;\n  }\n  .ant-card-cover {\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    & > div {\n      height: 171px;\n    }\n  }\n  .gradient-container > div {\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n    background-color: ${({ theme }) => theme.colors.secondary.light3};\n    display: inline-block;\n    width: 100%;\n    height: 179px;\n    background-repeat: no-repeat;\n    vertical-align: middle;\n  }\n`;\n\nconst QueryData = styled.div`\n  svg {\n    margin-left: ${({ theme }) => theme.gridUnit * 10}px;\n  }\n  .query-title {\n    padding: ${({ theme }) => theme.gridUnit * 2 + 2}px;\n    font-size: ${({ theme }) => theme.typography.sizes.l}px;\n  }\n`;\n\nconst QueryContainer = styled.div`\n  pre {\n    height: ${({ theme }) => theme.gridUnit * 40}px;\n    border: none !important;\n    background-color: ${({ theme }) =>\n      theme.colors.grayscale.light5} !important;\n    overflow: hidden;\n    padding: ${({ theme }) => theme.gridUnit * 4}px !important;\n  }\n`;\n\nconst SavedQueries = ({\n  user,\n  addDangerToast,\n  addSuccessToast,\n  mine,\n  showThumbnails,\n  featureFlag,\n}: SavedQueriesProps) => {\n  const {\n    state: { loading, resourceCollection: queries },\n    hasPerm,\n    fetchData,\n    refreshData,\n  } = useListViewResource<Query>(\n    'saved_query',\n    t('query'),\n    addDangerToast,\n    true,\n    mine,\n    [],\n    false,\n  );\n  const [queryFilter, setQueryFilter] = useState('Mine');\n  const [queryDeleteModal, setQueryDeleteModal] = useState(false);\n  const [currentlyEdited, setCurrentlyEdited] = useState<Query>({});\n  const [ifMine, setMine] = useState(true);\n  const canEdit = hasPerm('can_edit');\n  const canDelete = hasPerm('can_delete');\n\n  const theme = useTheme();\n\n  const handleQueryDelete = ({ id, label }: Query) => {\n    SupersetClient.delete({\n      endpoint: `/api/v1/saved_query/${id}`,\n    }).then(\n      () => {\n        const queryParams = {\n          filters: [\n            {\n              id: 'created_by',\n              operator: 'rel_o_m',\n              value: `${user?.userId}`,\n            },\n          ],\n          pageSize: PAGE_SIZE,\n          sortBy: [\n            {\n              id: 'changed_on_delta_humanized',\n              desc: true,\n            },\n          ],\n          pageIndex: 0,\n        };\n        // if mine is default there refresh data with current filters\n        const filter = ifMine ? queryParams : undefined;\n        refreshData(filter);\n        setMine(false);\n        setQueryDeleteModal(false);\n        addSuccessToast(t('Deleted: %s', label));\n      },\n      createErrorHandler(errMsg =>\n        addDangerToast(t('There was an issue deleting %s: %s', label, errMsg)),\n      ),\n    );\n  };\n\n  const getFilters = (filterName: string) => {\n    const filters = [];\n    if (filterName === 'Mine') {\n      filters.push({\n        id: 'created_by',\n        operator: 'rel_o_m',\n        value: `${user?.userId}`,\n      });\n    } else {\n      filters.push({\n        id: 'id',\n        operator: 'saved_query_is_fav',\n        value: true,\n      });\n    }\n    return filters;\n  };\n\n  const getData = (filter: string) =>\n    fetchData({\n      pageIndex: 0,\n      pageSize: PAGE_SIZE,\n      sortBy: [\n        {\n          id: 'changed_on_delta_humanized',\n          desc: true,\n        },\n      ],\n      filters: getFilters(filter),\n    });\n\n  const renderMenu = (query: Query) => (\n    <Menu>\n      {canEdit && (\n        <Menu.Item\n          onClick={() => {\n            window.location.href = `/superset/sqllab?savedQueryId=${query.id}`;\n          }}\n        >\n          {t('Edit')}\n        </Menu.Item>\n      )}\n      <Menu.Item\n        onClick={() => {\n          if (query.id) {\n            copyQueryLink(query.id, addDangerToast, addSuccessToast);\n          }\n        }}\n      >\n        {t('Share')}\n      </Menu.Item>\n      {canDelete && (\n        <Menu.Item\n          onClick={() => {\n            setQueryDeleteModal(true);\n            setCurrentlyEdited(query);\n          }}\n        >\n          {t('Delete')}\n        </Menu.Item>\n      )}\n    </Menu>\n  );\n\n  if (loading) return <Loading position=\"inline\" />;\n  return (\n    <>\n      {queryDeleteModal && (\n        <DeleteModal\n          description={t(\n            'This action will permanently delete the saved query.',\n          )}\n          onConfirm={() => {\n            if (queryDeleteModal) {\n              handleQueryDelete(currentlyEdited);\n            }\n          }}\n          onHide={() => {\n            setQueryDeleteModal(false);\n          }}\n          open\n          title={t('Delete Query?')}\n        />\n      )}\n      <SubMenu\n        activeChild={queryFilter}\n        tabs={[\n          /* @TODO uncomment when fav functionality is implemented\n          {\n            name: 'Favorite',\n            label: t('Favorite'),\n            onClick: () => {\n              getData('Favorite').then(() => setQueryFilter('Favorite'));\n            },\n          },\n          */\n          {\n            name: 'Mine',\n            label: t('Mine'),\n            onClick: () => getData('Mine').then(() => setQueryFilter('Mine')),\n          },\n        ]}\n        buttons={[\n          {\n            name: (\n              <>\n                <i className=\"fa fa-plus\" />\n                SQL Query\n              </>\n            ),\n            buttonStyle: 'tertiary',\n            onClick: () => {\n              window.location.href = '/superset/sqllab?new=true';\n            },\n          },\n          {\n            name: 'View All »',\n            buttonStyle: 'link',\n            onClick: () => {\n              window.location.href = '/savedqueryview/list';\n            },\n          },\n        ]}\n      />\n      {queries.length > 0 ? (\n        <CardContainer showThumbnails={showThumbnails}>\n          {queries.map(q => (\n            <CardStyles\n              onClick={() => {\n                window.location.href = `/superset/sqllab?savedQueryId=${q.id}`;\n              }}\n              key={q.id}\n            >\n              <ListViewCard\n                imgURL=\"\"\n                url={`/superset/sqllab?savedQueryId=${q.id}`}\n                title={q.label}\n                imgFallbackURL=\"/static/assets/images/empty-query.svg\"\n                description={t('Ran %s', q.changed_on_delta_humanized)}\n                cover={\n                  q?.sql?.length && showThumbnails && featureFlag ? (\n                    <QueryContainer>\n                      <SyntaxHighlighter\n                        language=\"sql\"\n                        lineProps={{\n                          style: {\n                            color: 'black',\n                            wordBreak: 'break-all',\n                            whiteSpace: 'pre-wrap',\n                          },\n                        }}\n                        style={github}\n                        wrapLines\n                        lineNumberStyle={{\n                          display: 'none',\n                        }}\n                        showLineNumbers={false}\n                      >\n                        {shortenSQL(q.sql, 25)}\n                      </SyntaxHighlighter>\n                    </QueryContainer>\n                  ) : showThumbnails && !q?.sql?.length ? (\n                    false\n                  ) : (\n                    <></>\n                  )\n                }\n                actions={\n                  <QueryData>\n                    <ListViewCard.Actions\n                      onClick={e => {\n                        e.stopPropagation();\n                        e.preventDefault();\n                      }}\n                    >\n                      <Dropdown overlay={renderMenu(q)}>\n                        <Icons.MoreHoriz\n                          iconColor={theme.colors.grayscale.base}\n                        />\n                      </Dropdown>\n                    </ListViewCard.Actions>\n                  </QueryData>\n                }\n              />\n            </CardStyles>\n          ))}\n        </CardContainer>\n      ) : (\n        <EmptyState tableName=\"SAVED_QUERIES\" tab={queryFilter} />\n      )}\n    </>\n  );\n};\n\nexport default withToasts(SavedQueries);\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}